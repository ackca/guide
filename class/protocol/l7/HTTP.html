<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>协议-HTTP</title>
	<script src="../../../js/head.js"></script>
	<script type="text/javascript">
		window.onload = createNavigation(http);
	</script>
	<style type="text/css">
		#tMethod .cell:nth-child(1)
        {
			width: 160px;
		}

		#tStatus1 .cell:nth-child(1),
		#tStatus2 .cell:nth-child(1)
        {
			width: 100px;
		}

		#tStatus2 .cell:nth-child(2)
        {
			font-weight: bold;
		}

		#tStatus1 .row:nth-child(4) .cell:nth-child(1),
		#tStatus1 .row:nth-child(4) .cell:nth-child(2)
        {
			vertical-align: middle;
		}

		#tStatus1 .row:nth-child(4) .cell:nth-child(3)
        {
			line-height: 30px;
		}

		#tStatus2 .row:nth-child(5) .cell,  /* 2XX状态码结束 */
		#tStatus2 .row:nth-child(10) .cell, /* 3XX状态码结束 */
		#tStatus2 .row:nth-child(16) .cell  /* 4XX状态码结束 */
		{
			border-bottom: solid 2px #FF6A6A;
		}

		#tStatus2 .row:nth-child(6) .cell,  /* 3XX状态码开始 */
		#tStatus2 .row:nth-child(11) .cell, /* 4XX状态码开始 */
		#tStatus2 .row:nth-child(17) .cell  /* 5XX状态码开始 */
		{
			border-top: solid 1px #FF6A6A;
		}

		.cmdInstruAllTopT2
        {
			margin-top: 20px;
		}
	</style>
</head>
<body>
	<div class="container-fluid">
		<div class="divProtocolWord">
			<script type="text/javascript">
				createProtocolWord(
					"HTTP",
					"HyperText Transfer Protocol",
					"超文本传输协议"
				);
			</script>
		</div>
	</div><br />
	<div id="divCommand">
		<script type="text/javascript">
			createInstruT0("HTTP 报文基本结构","i1");
                createInstruT1("报文基本结构","i1-1");
	                createConfigImgT1("HTTP/http");
	                createInstruAllTopT1("特定报文不包含 主体，比如 GET Request、204 Respose，但仍然包含空行");
	                createConfigImgT1("HTTP/http_packet");

                createInstruT1("首部结构","i1-2");
	                createInstruAllTopT1("首部采用键值类型，一行为一个首部，一个键，可能包含多个值");
	                createConfigImgT1("HTTP/headers");


                createInstruT1("请求首部结构","i1-3");
	                createConfigImgT1("HTTP/request_headers");
                    createConfigImgT1("HTTP/request");


                createInstruT1("响应首部结构","i1-4");
	                createConfigImgT1("HTTP/response_headers");
                    createConfigImgT1("HTTP/response");


            createInstruT0("HTTP 方法（methond）<br />","i3");
                tHeader = [
					"方法",
					"作用",
	                "说明"
				];

				tBody = [
					["GET","获取资源","可通过URL传输信息"],
					["POST","传输实体主体","通过主体传输信息，也可实现其它方法功能"],
					["PATCH","","在REST API中更新对应项部分内容"],
					["PUT","","在REST API中覆盖对应项全部内容"],
					["HEAD","获得报文首部",""],
					["DELETE","删除内容","也可用POST实现删除"],
					["OPTIONS","询问支持的方法",""],
					["TRACE","追踪路径",""],
					["CONNECT","要求用隧道协议连接代理",""],
					["LINK","建立和资源之间的联系","从HTTP 1.1开始，已废弃"],
					["UNLINK","断开连接关系","从HTTP 1.1开始，已废弃"],
				];
				createHLTableT0(820, tHeader, tBody, "tMethod");


            createInstruT0("<br />HTTP 状态码","i4");
                createInstruT1("状态码类型<br />","i4-1");
                    tHeader = [
						"状态码",
						"类别",
		                "原因短语"
					];

					tBody = [
						["1XX","Informational（信息性状态码）","可通过URL传输信息"],
						["2XX","Success（成功状态码）","请求正常处理完毕"],
						["3XX","Redirection（重定向状态码）","需要进行附加操作以完成请求<br />对于重定向地址通过 Location 字段实现"],
						["4XX","Client Error（客户端错误状态码）","服务器无法处理请求"],
						["5XX","Server Error（服务器错误状态码）","服务器处理请求出错"],
					];
					createHLTableT1(800, tHeader, tBody, "tStatus1");

                    document.write("<br /><br />");

				createInstruT1("状态码总览<br />","i4-6");
                    tHeader = [
						"状态码",
		                "原因短语",
	                    "说明"
					];
					tBody = [
						["200","OK","请求已经正常处理"],
						["201","Created","资源已经成功创建"],
						["204","No Content","请求已经正常处理，但没有资源返回"],
						["206","Partial Content","成功返回了部分内容"],
						["301","Moved Permanently","永久重定向"],
						["302","Moved Temporarily","临时重定向"],
						["303","See Other","临时重定向"],
						["304","Not Modified","继续使用缓存"],
						["307","Temporary Redirect","临时重定向"],
						["400","Bad Request","请求存在语法错误"],
						["401","Unauthorized","需要认证"],
						["403","Forbidden","请求的资源被拒绝"],
						["404","Not Found","请求的资源无法找到"],
						["405","Method Not Allowed","请求的方法不被允许"],
						["413","Request Fntity Too Large","请求的Body过大"],
						["500","Internal Server Error","服务器错误"],
						["503","Service Unavailable","服务器无法响应"],
					];
					createHLTableT1(750, tHeader, tBody, "tStatus2");

                createInstruT1("<br />2XX：成功","i4-2");
                    createInstruT2("200：OK","i4-2-1");
                        createInstruAllTopT2("最常见状态码，表示请求已经正常处理");


                    createInstruT2("<br />201：Created","i4-2-2");
                        createInstruAllTopT2("表示资源已经成功创建");
                        createInstruAllTopT2("如：使用以下方式创建环回接口，正常返回201");
                        createConfigImgT2("HTTP/201");


                    createInstruT2("204：No Content","i4-2-3");
                        createInstruAllTopT2("表示请求已经正常处理，但该请求没有资源可以返回");


                    createInstruT2("<br />206：Partial Content","i4-2-4");
                        createInstruAllTopT2("表示客户端进行了范围请求，而服务器成功返回了这部分内容");
                        createInstruAllTopT2("如：客户端想获取一个较大PDF中的部分页面");


                createInstruT1("<br />3XX：重定向","i4-3");
                    createInstruT2("301：Moved Permanently","i4-3-1");
                        createInstruAllTopT2("永久重定向，该状态码表示请求的资源已经被分配了新的URI，以后应使用现在所指的URI");
                        createInstruAllTopT2("一般用于网站搬迁，对仍使用旧URI的用户发送301，告知新URI");


                    createInstruT2("<br />302：Moved Temporarily","i4-3-2");
                        createInstruAllTopT2("临时重定向，该状态码表示请求的资源已经被分配了新的URI，希望本次使用新的URI访问");
                        createInstruAllTopT2("302为HTTP 1.0的旧方案，307为302的替代方案");


                    createInstruT2("<br />303：See Other","i4-3-3");
                        createInstruAllTopT2("该状态码表示请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源");
                        createInstruAllTopT2("303与302有着相似的功能，但‘303明确表示客户端应当采用GET方法获取资源。");


                    createInstruT2("<br />304：Not Modified","i4-3-4");
                        createInstruAllTopT2("该状态码表示请求对应的资源之前已经发送并要求缓存，本次请求对应的资源没有改变，应继续使用缓存");
                        createInstruAllTopT2("304虽然在3XX系列中，但和重定向无关");
                        createInstruAllTopT2("某些浏览器不支持缓存，如：Chrome，会在请求头部中添加 Cache-Control: no-cache 表明不使用缓存");


                    createInstruT2("<br />307：Temporary Redirect","i4-3-5");
                        createInstruAllTopT2("临时重定向，与302相似，虽然302禁止将原始POST请求变成GET请求到重定向页面，但浏览器未必遵守");
                        createInstruAllTopT2("但307会遵照浏览器标准，原始请求方法与重定向请求方法相同");


				createInstruT1("<br />4XX：客户端错误","i4-4");
                    createInstruT2("400：Bad Request","i4-4-1");
                        createInstruAllTopT2("该状态码表示请求中存在语法错误，如：URL编码无法解析");


                    createInstruT2("<br />401：Uncuthorized","i4-4-2");
                        createInstruAllTopT2("该状态码表示发送的请求需要通过有HTTP认证（BASIC认证、DIGEST认证）的认证信息");
                        createInstruAllTopT2("如果之前已经进行过1次请求，则表示用户认证失败");
                        createInstruAllTopT2("返回的401响应中包含适用于被请求资源的WWW Authenticate首部用以质询（challenge）用户信息");
                        createInstruAllTopT2("当浏览器初次接收到401响应，会认证用的对话窗口");


                    createInstruT2("<br />403：Forbidden","i4-4-3");
                        createInstruAllTopT2("该状态码表示请求资源的访问被服务器拒绝");
                        createInstruAllTopT2("服务器没有必要经出拒绝的详细理由，但如果想说明的话，可以在主体部分对原因进行描述");;


                    createInstruT2("<br />404：Not Found","i4-4-4");
                        createInstruAllTopT2("该状态码表示请求资源没有找到，也可以在拒绝请求且不想说明理由时使用");


                    createInstruT2("<br />405：Method Not Allowed","i4-4-5");
                        createInstruAllTopT2("该状态码表示请求的方法不被允许");


                    createInstruT2("<br />413：Request Fntity Too Large","i4-4-6");
                        createInstruAllTopT2("该状态码表示请求的Body过大，超过了服务器的限制");


                createInstruT1("<br />5XX：服务器错误","i4-5");
                    createInstruT2("500：Internal Server Error","i4-5-1");
                        createInstruAllTopT2("该状态码表示服务器在处理请求时发生了错误");


                    createInstruT2("<br />503：Service Unavailable","i4-5-2");
                        createInstruAllTopT2("该状态码表示服务器暂时处理超负载或正在进行停机维护");


			createInstruT0("<br />HTTP 通用首部","i5");
                createInstruT1("通用首部总览<br />","i5-1");
                    tHeader = [
						"首部名称",
		                "首部作用",
					];
					tBody = [
						["Cache-Control","管理缓存的工作机制"],
						["Connection","连接类型"],
						["Date","创建报文的时间日期"],
						["Transfer-Encoding","传输文件主体的编码方式"],
						["Upgrade","是否可使用更高版本协议通信"],
						["Warning","警告信息"],
					];
					createHLTableT1(750, tHeader, tBody, "tRequestHeaders");


                createInstruT1("<br />Cache-Control：管理缓存的工作机制","i5-2-1");
                    createInstruT2("启用缓存时的工作原理","i5-2-1");
                        createInstruT3("第一次请求与响应");
		                    htmlheaders = `
								GET / HTTP/1.1
							`;
							createHTTPHeadersT3(htmlheaders);

                            htmlheaders = `
								HTTP/1.1 200 OK
								Server: nginx
								Last-Modified: Thu, 12 Oct 2023 06:16:07 GMT    # 上次修改时间
								ETag: "65278f27-1dbf"                           # 当前资源的ID
								Expires: Sat, 11 Nov 2023 07:40:26 GMT          # 缓存过期时间
								Cache-Control: max-age=2592000                  # 缓存有效期
								Cache-Control: public, no-gransform             # 支持缓存
							`;
							createHTTPHeadersT3(htmlheaders);

                        createInstruT3("继续请求与响应（服务端未修改）");
                            htmlheaders = `
								GET / HTTP/1.1
								If-Modified-Since: Thu, 12 Oct 2023 06:16:07 GMT    # 缓存修改时间
								If-None-Match: "65278f27-1dbf"                      # 缓存的ID
							`;
							createHTTPHeadersT3(htmlheaders);

                            htmlheaders = `
								HTTP/1.1 304 Not Modified                       # 继续使用缓存
								Server: nginx
								Last-Modified: Thu, 12 Oct 2023 06:16:07 GMT    # 上次修改时间
								ETag: "65278f27-1dbf"                           # 当前资源的ID
								Expires: Sat, 11 Nov 2023 07:41:12 GMT          # 由于再次访问，缓存过期时间更新
								Cache-Control: max-age=2592000                  # 缓存有效期
								Cache-Control: public, no-gransform             # 支持缓存
							`;
							createHTTPHeadersT3(htmlheaders);

                        createInstruT3("继续请求与响应（服务端已修改）");
                            htmlheaders = `
								GET / HTTP/1.1
								If-Modified-Since: Thu, 12 Oct 2023 06:16:07 GMT    # 缓存修改时间
								If-None-Match: "65278f27-1dbf"                      # 缓存的ID
							`;
							createHTTPHeadersT3(htmlheaders);

                            htmlheaders = `
								HTTP/1.1 200 OK                                 # 由于资源已经改变，状态码为200
								Server: nginx
								Last-Modified: Thu, 12 Oct 2023 07:42:06 GMT    # 上次修改时间，已经更新
								ETag: "6527a34e-1daa"                           # 当前资源的ID，已经更新
								Expires: Sat, 11 Nov 2023 07:42:21 GMT          # 缓存过期时间，已经更新
								Cache-Control: max-age=2592000                  # 缓存有效期，仅修改资源内容，未修改缓存策略
								Cache-Control: public, no-gransform             # 支持缓存
							`;
							createHTTPHeadersT3(htmlheaders);

                    createInstruT2("不支持缓存","i5-2-2");
                        htmlheaders = `
							Cache-Control: private, max-age=0, no-cache
						`;
						createHTTPHeadersT2(htmlheaders);


                createInstruT1("<br />Connection：连接类型","i5-3");
	                createInstruT2("目前的HTTP连接均为持久化连接，该首部没有必要");
	                    htmlheaders = `
							Connection: keep-alive
						`;
						createHTTPHeadersT2(htmlheaders);

					createInstruT2("如有特殊情况，可以不使用持久化连接");
	                    htmlheaders = `
							Connection: close
						`;
						createHTTPHeadersT2(htmlheaders);


                createInstruT1("<br />Date：创建报文的时间日期","i5-4");
                    htmlheaders = `
						Date: Thu, 12 Oct 2023 07:42:21 GMT
					`;
					createHTTPHeadersT1(htmlheaders);


                createInstruT1("<br />Transfer-Encoding：传输文件主体的编码方式","i5-5");
                    createInstruT2("一般用于分块传输资源时");
                    htmlheaders = `
						Transfer-Encoding: chunked
					`;
					createHTTPHeadersT1(htmlheaders);


                createInstruT1("<br />Upgrade：是否可使用更高版本协议通信","i5-6");
                    createInstruAllTopT1("首部字段Upgrade用于检测HTTP协议及其他协议是否可以使用更高的版本进行通信");
                    createInstruAllTopT1("其参数值可以用来指定一个完全不同的通信协议");

                    htmlheaders = `
						GET / HTTP/1.1
						Upgrade: TLS/1.0
						Connection: Upgrade
					`;
					createHTTPHeadersT1(htmlheaders);

                    htmlheaders = `
						HTTP/1.1 101 Switching Protocols
						Upgrade: TLS/1.0, HTTP/1.1
						Connection: Upgrade
					`;
					createHTTPHeadersT1(htmlheaders);


                createInstruT1("<br />Warning：警告信息","i5-7");
					createInstruAllTopT1("通常会告知用户一些与缓存相关问题的警告");
                    createInstruAllTopT1("<a class='link' href='https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Warning' target='_blank'>https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Warning</a>");
                    createInstruAllTopT1("格式如下，最后的日期时间部分可省略");

					htmlheaders = `
						Waring: [ 警告码 ] [警告的主机：端口号] "[警告内容]" ( [ 日期时间 ] )
					`;
					createHTTPHeadersT1(htmlheaders);


            createInstruT0("HTTP认证","i8");
                createInstruT1("基本认证（Basic auth）","i8-1");
                    createInstruAllTopT1("浏览器弹出窗口认证");
                    createConfigImgT1("HTTP/basic");

                createInstruT1("散列认证（Digest auth）","i8-2");
                    createInstruAllTopT1("浏览器弹出窗口认证");
                    createConfigImgT1("HTTP/digest");

                createInstruT1("表单认证","i8-3");
                    createInstruAllTopT1("最常见的网站中使用页面登录");
                    createConfigImgT1("HTTP/form");


			createInstruT0("HTTP 版本与历史","i9");
                createInstruT1("HTTP/1.0","i9-1");
                    createInstruAllTopT1("一次TCP连接只做一次HTTP请求，完成后TCP关闭，效率较低");

				createInstruT1("<br />HTTP/1.1","i9-2");
					createInstruAllTopT1("使用keep-alive技术，在一次TCP连接中，实现多次HTTP请求");
                    createInstruAllTopT1("但同一时间只进行一次HTTP请求，下次请求必须等待本次请求结束后进行，效率仍然较低");
                    createInstruAllTopT1("为了提高效率，主流浏览器同时使用6个并发的TCP连接，但这样会消耗较多的服务器资源");


                createInstruT1("<br />HTTP/2","i9-3");
                    createInstruT2("核心技术：二进制帧","i9-3-1");
                        createInstruAllTopT2("HTTP/1.1及以前的HTTP，采用纯文本格式，因此在首部和主体之间需要空行分割");
                        createInstruAllTopT2("而HTTP/2采用二进制帧，可以直接区分首部和数据，不再需要空行");
                        createConfigImgT2("HTTP/http2");


                    createInstruT2("<br />优势1：一次TCP连接多次HTTP请求","i9-3-2");
						createInstruAllTopT2("stream（流）：　　　一个stream，即一次请求与响应");
                        createInstruAllTopT2("message（信息）：一个stream，包含一个请求的message，以及一个响应的message");
                        createInstruAllTopT2("frame（帧）：　　　　一次请求（响应）中，包含一个 首部的帧，请求（响应）中如果包含主体，还会包含 数据帧");
                        createInstruAllTopT2("一次TCP连接中包含多个stream，一个TCP报文中可能包含多个流的多个帧，接收方根据流ID进行重组装");


                    createInstruT2("<br />优势2：首部压缩","i9-3-3");
                        createInstruAllTopT2("打开一个页面会有多次请求，也就需要发送多次首部，很多首部是相同的（如：user-agent），没有必要反复发送");
						createInstruAllTopT2("HTTP/2首次发送请求时，包含全部首部，同时维护索引表，后续请求中，不变的头部直接发送索引编号即可");
                        createInstruAllTopT2("首部除了使用索引表外，还有压缩功能，进一步减小首部大小");


                    createInstruT2("<br />优势3：服务推送","i9-3-4");
						createInstruAllTopT2("通常，一个页面中还包含若干.js .css文件，客户端首先得到主页面，然后再去请求页面中包含的.js .css等其它内容");
                        createInstruAllTopT2("HTTP/2可以在发送主页面时，也把页面中的其它内容一起发送客户端");
                        createInstruAllTopT2("但是，页面中可能存在一些有安全风险的内容，一起发送有安全隐患");
                        createInstruAllTopT2("　　　　　页面还可能存在一些客户端已经获得的内容，没必须接收");
                        createInstruAllTopT2("因此，主流浏览器并不接受服务推送功能");


                    createInstruT2("<br />优势4：必须TLS加密","i9-3-5");
                        createInstruAllTopT2("HTTP/2 必须使用TLS加密的https，不加密http为 HTTP/1.1");


                    createInstruT2("<br />优势5：可以在TLS阶段进行HTTP协商","i9-3-6");
                        createInstruAllTopT2("HTTP/1.1时，HTTP的相关协商，在TLS隧道建立完成后进行");
                        createInstruAllTopT2("HTTP/2时，TLS协商过程中，同时进行HTTP的相关协商");


                    createInstruT2("<br />不足","i9-3-7");
                        createInstruAllTopT2("服务推送存在安全隐患，也有可能推送不必要的内容");
                        createInstruAllTopT2("<br />主要问题：");
                        createInstruAllTopT2("　　HTTP/2上层使用TCP协议，又能够在一个TCP连接中进行多次TCP请求");
                        createInstruAllTopT2("　　由于TCP本身的机制，多个流（stream），可能放在一个TCP报文中，一旦丢包，则需要进行重传");
						createInstruAllTopT2("　　如果网络质量较差，多次重次，实际效率还不如HTTP/1.1");


                createInstruT1("<br />HTTP/3","i9-4");
                    createInstruAllTopT1("HTTP/3上层使用UDP，并使用QUIC技术提供可靠性保障，且必须使用TLS1.3");
                    createInstruAllTopT1("QUIC：Quick UDP Internet Connections，快速的UDP网络连接");
                    createInstruAllTopT1("由于使用UDP封装，一个报文中只包含一个帧，即使丢包，也只需要重传很少的部分");

		</script>

		<br /><br /><br /><br /><br /><br /><br />
		<br /><br /><br /><br /><br /><br /><br />
	</div>

	<script type="text/javascript">
		function toStatusNO(id) {
	        href = window.location.href.split('#')[0];
			location.href = href + id;
			topp = $('#divCommand').offset().top + 160;

			leftt = $('#divCommand').offset().left;
			$('#divCommand').offset({top:topp,left:leftt});
        }
		
		$('#tStatus2 .row').click(function(){
			index = $('#tStatus2 .row').index($(this)); // 获取该行在表格中为第几行

			switch (index) {
				case 1: // 200 OK
                    toStatusNO("#i4-2-1");
                    break;

                case 2: // 201 Created
                    toStatusNO("#i4-2-2");
                    break;

                case 3: // 204 No Content
                    toStatusNO("#i4-2-3");
                    break;

                case 4: // 206 Partial Content
                    toStatusNO("#i4-2-4");
                    break;

                case 5: // 301 Moved Permanently
                    toStatusNO("#i4-3-1");
                    break;

                case 6: // 302 Moved Temporarily
                    toStatusNO("#i4-3-2");
                    break;

                case 7: // 303 See Other
                    toStatusNO("#i4-3-3");
                    break;

                case 8: // 304 Not Modified
                    toStatusNO("#i4-3-4");
                    break;

                case 9: // 307 Temporary Redirect
                    toStatusNO("#i4-3-5");
                    break;

                case 10: // 400 Bad Request
                    toStatusNO("#i4-4-1");
                    break;

                case 11: // 401 Uncuthorized
                    toStatusNO("#i4-4-2");
                    break;

                case 12: // 403 Forbidden
                    toStatusNO("#i4-4-3");
                    break;

                case 13: // 404 Not Found
                    toStatusNO("#i4-4-4");
                    break;

                case 14: // 405 Method Not Allowed
                    toStatusNO("#i4-4-5");
                    break;

                case 15: // 413 Request Fntity Too Large
                    toStatusNO("#i4-4-6");
                    break;

                case 16: // 500 Internal Server Error
                    toStatusNO("#i4-5-1");
                    break;

                case 17: // 503 Service Unavailable
                    toStatusNO("#i4-5-2");
                    break;
            }
		});
	</script>
</body>
</html>